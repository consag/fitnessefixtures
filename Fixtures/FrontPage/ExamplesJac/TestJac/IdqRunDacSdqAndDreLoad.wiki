---
Test
---
!define TEST_SYSTEM {slim} 
!path ../fitnesse/lib/*.jar
!path ../fitnesse/fixtures/bin
!path ../fitnesse/java_workspace/fixtures
!path ../fitnesse/sqldeveloper/jdbc/lib/ojdbc6.jar
!path /u01/app/ibm/db2c/db2inst/sqllib/java/db2jcc_license_cisuz.jar
!path ../fitnesse/ibm
!path ../fitnesse/dac/DAWSystem.jar
!path ../fitnesse/config

|import                       |
|generic.fixtures.Global      |
|generic.fixtures.PWCFixture  |
|generic.fixtures.LinuxFixture|
|generic.fixtures.DBFixture   |
|generic.fixtures.DACFixture  |

!lastmodified

!define execPlan {!-SDQ and DRE Load-!}
!define app {IDQ}

!1 Check execution plan documentation and example

!2 Checks before you run an execution plan
Run the following checks before you execute an execution plan. For example, right after a deployment.

!3 How many tasks are defined in the execution plan?
This checks the number of tasks in an execution plan. It can be used before running an execution plan.
It checks the number of DEFINED tasks. This may be different from the number of tasks executed during a run. See further below on how that number can be verified.

|script|Check Exec Plan        |${app}|${execPlan}|
|check |number of tasks defined|42                           |

!3 Which tasks are defined in which order?
The following checks in which order the tasks are defined/generated in a given execution plan.
If more tasks are defined, these will be added and marked red.
If the execution plan contains less tasks than expected, the ones not found will be marked red.

|Table: Check Exec Plan|${app}|${execPlan}|List Defined Tasks|
|Order                 |Task                                           |
|0                     |Change Capture For Siebel OLTP                 |
|1                     |Extract for Territory Dimension                |
|2                     |Change Capture Sync For Siebel OLTP            |
|3                     |QUERY_INDEX_CREATION                           |

!2 Run your execution plan - Full or Incremental
!3 Start the execution plan

In this example a full load is done for execution plan "RB Fitnesse Fixture Test"
|Run Exec Plan                                                                  |
|Env|exec Plan Name          |run mode|start Plan successful?|get log filename?|
|${app}|${execPlan}|Full    |Success                |                 |

!3 Wait on the completion of the execution plan
|Run Exec Plan                                      |
|Env|exec Plan Name          |Stop on Errors|Result?|
|${app}|${execPlan}|No            |Success|

!2 Check the execution plan results
The following tests can be defined to verify the outcome of the execution plan and its tasks.

!3 Check the order in which the tasks ran
List the tasks in the order you expect them to run.
The first line contains the application (EB2), the execution plan (RB Fitnesse Fixture Test), which run you want the results for (LATEST), and what kind of list you want (List Order of Executed Tasks).
"List Order of Executed Tasks" is the only valid entry in this version of the fixture.

|Table: Check Exec Plan|${app}|${execPlan}|LATEST|List Order of Executed Tasks|
|Order                 |Task                                                            |
|0                     |Change Capture For Siebel OLTP                                  |
|1                     |Extract for Territory Dimension                                 |
|2                     |Change Capture Sync For Siebel OLTP                             |
|3                     |QUERY_INDEX_CREATION                                            |

!3 Check the amount of records processed
For each task you can request the number of records processed.
In the example, checks are conducted for the application EB2 and the execution plan "RB Fitnesse Fixture Test", LATEST run.
The following checks are possible:

* total number of executed tasks
   The total number of tasks regardless of whether or not these ran or were successful or not
* failed tasks
   The number of failed or stopped tasks
* successful tasks
   The number of successfully executed tasks
* queued tasks
   The number of queued tasks. This can be used on a monitoring page to check the progress of an execution plan
* runnable tasks
   The number of runnable tasks, i.e. tasks that could run, but do not, because of the maximum number of concurrent tasks specified in DAC
* running tasks
   The number of currently running tasks. This can be used on a monitoring page to check the progress of an execution plan


|script|Check Exec Plan               |${app}                            |${execPlan}|LATEST|
|check |total number of executed tasks|42                                                              |
|check |failed tasks                  |0                                                              |
|check |successful tasks              |42                                                              |
|check |task or task detail           |Change Capture For Siebel OLTP |number of records       |0     |

